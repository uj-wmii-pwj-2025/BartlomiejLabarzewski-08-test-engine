package uj.wmii.pwj.anns;

import java.lang.reflect.Method;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

public class TestDisplayer {

    String PASS_COLOR = "\u001B[32m";
    String FAIL_COLOR = "\u001B[31m";
    String ERROR_COLOR = "\u001B[33m";
    String RESET_COLOR = "\u001B[0m";
    String START_COLOR = "\u001B[35m";

    public TestDisplayer() {
    }

    public void displayHeader() {
        displayBanner();
        displayGandalf();
        System.out.println();
        System.out.println();
    }

    private void displayBanner() {

        System.out.println("__   _______ _   _    _____ _   _   ___   _      _        _   _ _____ _____   ______  ___   _____ _____ \n" +
                "\\ \\ / /  _  | | | |  /  ___| | | | / _ \\ | |    | |      | \\ | |  _  |_   _|  | ___ \\/ _ \\ /  ___/  ___|\n" +
                " \\ V /| | | | | | |  \\ `--.| |_| |/ /_\\ \\| |    | |      |  \\| | | | | | |    | |_/ / /_\\ \\\\ `--.\\ `--. \n" +
                "  \\ / | | | | | | |   `--. \\  _  ||  _  || |    | |      | . ` | | | | | |    |  __/|  _  | `--. \\`--. \\\n" +
                "  | | \\ \\_/ / |_| |  /\\__/ / | | || | | || |____| |____  | |\\  \\ \\_/ / | |    | |   | | | |/\\__/ /\\__/ /\n" +
                "  \\_/  \\___/ \\___/   \\____/\\_| |_/\\_| |_/\\_____/\\_____/  \\_| \\_/\\___/  \\_/    \\_|   \\_| |_/\\____/\\____/ \n" +
                "                                                                                                        \n" +
                "                                                                                                        "
        );

    }

    private void displayGandalf() {

        System.out.println("                                                    :                                    .-=#-          \n" +
                "                                                   .                                      .-=+:..       \n" +
                "                                                                                            .::..       \n" +
                "                                                :                                            ....:..    \n" +
                "                                                                                              ......=   \n" +
                "                                                                                                ..:-=+  \n" +
                "                                                                                                   :.::.\n" +
                "                                                          **%@%####=                                .:.:\n" +
                "                                                      @@@@%%#@@%##+===+:                              ..\n" +
                "                                                   -@@@@@%###@%###%##+=+-:.                            :\n" +
                "                                       .          +@@@@@##%@@@@@%#%*##++++=                             \n" +
                "                                                 +@%#@%%@@@@@@@@%####++++==:.                           \n" +
                "                                                +@@%%#%#%%@@@@%#***+++*=+*+-.                           \n" +
                "                                   .           *@@*+#%#%%@@@@@@@%=---==+++==+-.                         \n" +
                "                                  .           -%%#+#*+=+=+@@@@%*=**+=:-+=***+*=.                        \n" +
                "                                 .           -+%%*--++##+**=%@+=-+*----=++##**-::.                      \n" +
                "                                .          :.++%#++=++*#%@@@##*@@@%#*+==+=*%##-:-.                      \n" +
                "                                            -@#+-*+-*##%%#@#%@**%%+=**=::: +*+**+-  :                   \n" +
                "                                          =%@@*=:==:=+#%@@@*%@#*#@@*+=:..: -::+##+*+::                  \n" +
                "                            .             .=*@-:====+=+*#@+-+#+:=%%*:...:--==-=.+*=+*-:   .             \n" +
                "                                         --+=::++*=+++==*@%*=-++*%@#=-=-+=::.=*+-=*=++.                 \n" +
                "                                           +==*+*#++++**%@%%%%@%#*#%##*++++:.==+:-=*.++.                \n" +
                "                                      -.   #%#*#%*==+*%%@*=::=+*#+*+#+*+===+-..-.=:-. :.-               \n" +
                "                       :                 .-+=#**#+****#@@%%%++++++###*%%++==-...+.+---.   :==-.    .    \n" +
                "                      =           =*++***##+%%*+#****#%%#%%%#####%@%**#*+++==..:++==+=-.-::...--++::.:: \n" +
                "                     :    -+***##+-==--=+*%#@#+:++%++*##%@%@%%#%%%@%##*++===: :::::--...=::..  ......::-\n" +
                "                        -*++++*-:--=-:==-+@##::.+*+=+*##%@%@@%%@%%%@%%*++=-==.:.::*=.:.:. :.:-:. ..::-:.\n" +
                "                 :.    -+=-=+-:=---:.:-:=:+=:==*%+==+*+*#%%@%%%@%%#%@###*+=-==:=+-*+:-. ....::::::....  \n" +
                "              --.     -:--=-:::---. :::=-:=:=:=*+=+-++***%%%%#%%%%#%%%%%#*++==-..-.+:.:......::.......  \n" +
                "            -...     ---=-::.:--:. .:.:-..+.+-+++*+=*+****%##%##%#%%%%@%##**++=:-:..=.   .  ...:.....  .\n" +
                "    :++=+**=-:.    .---::   ::::   :..::..+*.+=+==-+++****#%%%%##%#%%%#%@%#**++===*.*.   ..    .....    \n" +
                ":=: ::--=::--     ..:::.  ::::.   . ...::.:.-=:===-=+++*##*#%%%%%#%##%%%%%%%#*+=-:=:==-:              . \n" +
                ":-----:  ::.     ::::.    .::.   :  ...   .:.:.=+::=++++**###%%%%%%%%%%%%%#%%#*++:::--+=-:.             \n" +
                "*.:=--:-:.      ::.      ::..   ..  .  . .:-..:==:-==+=*****##%%#%#%%%%%#%%%%%#*=-.+  ...               \n" +
                ".   .::.                :...   ..  ...:. :--.=+-..--:=+*#*+#***%%%##%%%%%%##%@%#=::-:  .  .             \n" +
                "=: :. ..              .:..    ..   ...-  . .:--....--.=**#**#***%%%###%%%%###%%#*=::   :   .            \n" +
                ":==         .. .  ....        ..   . .::....  . ..:-.:=****++#***#%#####%%%#%#%%#=:.    .     ..        \n" +
                " :-          .......          ..   .  .. ... :..:. -=:-=*#++++****#######%#%#####++- .                  \n" +
                "..            ..:.:......  ....    .  .. . .  :::::. .--+**+**=*#**####+*##%###***+:...                 \n" +
                "+..             .:::..........        .. . . .. :: ...:::+**=+++***###**+*#%%##*+*+=. ..                \n" +
                "=    ..            ........  .    .      . ...  .   ....::*#+++=+*******==**####++*-=                   \n" +
                ". @ .::.       .      .....      .    .  .  ......  .::-:.:+**===+******+=+***###**+-.                  "
        );
    }

    private void displayGandalfSax() {
        System.out.println(":::::::::::::----:=====++++++++++******###%%%%%%%%%%%%@%%%%%%%%@@@@@%%%@@@@@@@@@%##%%%#######***********\n" +
                "...:::::::::-===--======+++++=++***#######*######%%%%%%%%%%@@@%%%%%@@@@@%@@@@@@@@%##%%##%%%######**#%%##\n" +
                ".::---=++=-==++++==+=+++====+++**###****+*###%%%%%%%%%#%%%%%%%@@@@@@@@@@@@@@@@@@@@%%%####%%%%%%%##*##%##\n" +
                "::--=+++*++==++++===+++===++++*+++=++*#%%%%%#######%%%%#%%%%%%%%%%@@@@@@@@@@@@@@@@@%######%%%%%%###**###\n" +
                ":::-=++++*+===+++++====+=+++++==+*###############%#%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@%%%%###%%%%%%#####%%#\n" +
                "::--=+****+=+***+++==++++====+##%%###%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%#########\n" +
                "..:-========+**+====+++==+*#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%#######\n" +
                "...:-=-----==+=--=++++#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%##\n" +
                "   .:::--=-:::::-=+*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@\n" +
                "......::::::..:+#%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@%%%%%%%%%########**++==---------------=+======---\n" +
                "......::::-+#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#########****+==--::::::...             ......:.......\n" +
                "....::=*#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#####**#***+++=====----::.                               .........\n" +
                ".:=*%%%%%%%%%%%%%%%%%%%%%%%%##%######*+++=====-:::::::.......                                    ...  ..\n" +
                "%%%%%%%%%%%%%%%%%#%%%####*##**++++=====--::::...::::......::::::::...                               ... \n" +
                "%%%%%%%%##%%###******++===---:::..........::-:----=---------==----::::.                                .\n" +
                "%%#######**+=-==---::::::.....    .      ...::--====---==--=+=--:..                                     \n" +
                "###*++=--::::........      ....        .     .::--==--===--==-::::::::.....   ..                        \n" +
                "==--::.       .. ...       ...........::-----::::-=--====---===-----------::....                        \n" +
                ". .         ....:.        ........::------=====--:::-=====-:.::------======-:....  .                    \n" +
                "           ...:..       .........::---:: ....::::...::::::-:.:..    :.  .:==-....                       \n" +
                "           .:::        .........:-:    ......     ...  ...::.::...::----:::--:....     .                \n" +
                "          .:::          ..........::::-------::..   .....:::::::::--=+===----::....                     \n" +
                "         .:::..          .......::::----===--::........::::::------========---:.:.. .                   \n" +
                "        ..::..           .......:-.:..:---:::::.........::::-----------=----==-::.     .....            \n" +
                "       ...:...           ......:::::-::-::::.........  ..::::-----------=====--:-:..     ...            \n" +
                "      ... ...            .....:::----:::::::.::::......:::::::--=====-====+==-----:...    ...           \n" +
                "     ... ...              ....::----::::::::--.   ....:::----:::::=+++======-=----:::::.   ...          \n" +
                "    .... ..                ..::---:::-----==-. .....::----===--:---=+**+++==---------:::. ....          \n" +
                "   . ..  .                 ..:::------=====-:.:---::--====+==---====++**++====----------:  .:.          \n" +
                "   ...                     ..::------====+=-:::--=----===++==-==+*+==+**++===-------::---. ....         \n" +
                "  ...   .                  ..:::-----==+==-----::::---===++====+++++==++++=======---::-:-..::..         \n" +
                " ...   .                    ..:::-----==-===----------======++++++=+==++++=====----::----:.::...        \n" +
                " ..              ....        ...::---====--=========--===++=======++++++++=====-------==::..:::.        \n" +
                ".               ....  .       ..::---======++++++=++======++===++++**+++++====---------=--.:-::         \n" +
                "               .....:....    .....:--=====+++++++++++==++=++===++******+++====-------==---:--:..        \n" +
                "              .........       ....:--===++++=====++========-===++*******++====-:---------===-::.     .:-\n" +
                ".           . ........  ...  ....:---=++++++=:  . ::---:--=-=-..:+*******==-------------=====-::::--++-:\n" +
                " .            .   ...  ..........:---=++++++=--.    ..... ..   .-=++*****+==--:::::----==========*+-:::-\n" +
                ":.               ........:::.....::-++==+=++---::......... .::-==++++****++==-:::::--==========+++++-::.\n" +
                "....     ..     ..:...:.:::....:::==++=+==+=-==------------=++++++++++++++++=---:---==++==+====+**++*=. \n" +
                "........ ....  ..::.:::::::::..:--=++==+===--=--=-=========+++++++==+++++++====---===++======+++#*++*+-:\n" +
                ". ....... .:.  .:-:.:::::::::::----=++=++=----------===--===+++=+===+===+++====-=============+++###*+==:\n" +
                "  .. .. ......::-::.::::::::-:::---=++++++=-=-----------==============--+++====-==============++#%%#*=++\n" +
                "   .   . .::::--::::.:---.----------====+++==----:::::----===----=-==---++*++++=+=====++=++==++**##%#*=:\n" +
                "    .  . .:::--::::.:::-:--------------:-+++-=----.......:------=-------=*+++=++====++=+++++==+**#####*-\n" +
                "    .    .::--:::.::::-----------==-=---=+++=-==--::..::::------==------=+++++++++++++++++++===+*##%%##*\n" +
                "          .:--:::::::--::=-:-------==--=++++===-=----:---=--==========-=++++*++++++++++++++++***####%%#*\n" +
                "          ..-::::::------=-:-:-----===-=+++======----==============++++++++++*+++++++++++++**##*###%%%%#\n" +
                "          . :-::::--==-:--::-------=-=-==+==+--=====-=========+++++++++++++++++*++++++++++***######%#%%%\n" +
                "          . .:.:::---=-:--------:-----==-=+++====--======+++-===++==+++=+=+++++++++++++*+**##%%%%%%%%%%%\n" +
                "  ..        ....:.:------:------::----=======-====-==--=++++====++++++++++==++++++++++****##%%%%%%%###%%\n" +
                "        ..    ....:----==------::---=-====+===-=======-==+++++==+++++++++++++++++++++*****#%%%%#%#**####\n" +
                "   .          ...::-=---==-----::---=-=---++===-=========++++++===++++++++++++++++++**###%#%%%%%###**###\n" +
                "::.....         .::----=------::::--====--=+======+===+=-==+++++=+=+++++++++**+++****###%%%%%%%%%%##%%%%\n" +
                ":--:.:::..:... ..::-:-=---------::--===-+=++=-=====++=+--===+++++++++++**+++****++***##%%%%%%%%%%%%##*##\n" +
                " ...::::......: .::::--=-----------======+++=-=+++=++=++=====+++=+++++++++++*+******###%%%%%%%%%%%%#***#\n" +
                ". ..:  .::::..:. .:::----=--:--:--===+==+++++===++++++=++=+=+++++++++++**+++*******######%%%%%%%%%%%%#++");
    }

    public void displayError(Throwable e) {
        System.out.print(FAIL_COLOR);
        System.out.println(e.toString());
        System.out.println(Arrays.stream(e.getStackTrace()).map(StackTraceElement::toString).collect(Collectors.joining("\n")));
        System.out.println(RESET_COLOR);
    }

    public void displayLogErrorInfo(Throwable e, int errors) {
        System.out.println("To see the test log, read the log file \".ysnp/Logs/" + errors + ".txt\"\n");
    }

    public void displayTestedClass(Class<?> testedClass) {

        System.out.printf("Testing class: %s\n", testedClass);
        System.out.println();

    }

    public void displayLaunchMessage(Method method, String param, TestResult expectedResult) {

        System.out.print("╔═" + START_COLOR + "[LAUNCH]:  " + RESET_COLOR + method.getName() + "(");
        if (!param.isEmpty()) {
            System.out.print(param);
        }
        System.out.println(")");
        System.out.println("║ " + START_COLOR + "[EXPECT]:  " + RESET_COLOR + expectedResult);
        System.out.println();

    }

    public void displayResultMessage(Method method, String param, TestResult expectedResult, TestResult actualResult) {

        System.out.println();
        switch (actualResult) {
            case PASS:
                System.out.print("║ " + PASS_COLOR + "[PASSED]:  " + RESET_COLOR);
                break;
            case FAIL:
                System.out.print("║ " + FAIL_COLOR + "[FAILED]:  " + RESET_COLOR);
                break;
            case ERROR:
                System.out.print("║ " + ERROR_COLOR + "[THROWN]:  " + RESET_COLOR);
                break;
        }

        System.out.print(method.getName() + "(");
        if (param.isEmpty()) {
            System.out.print(param);
        }
        System.out.println(")");

        System.out.println("║ " + START_COLOR + "[EXPECT]:  " + RESET_COLOR + expectedResult);
        System.out.println("╚═" + START_COLOR + "[ACTUAL]:  " + RESET_COLOR + actualResult);

        System.out.println();
        System.out.println();

    }

    public void displaySummary(List<String> passes, List<String> fails, List<String> errors) {

        if (passes.isEmpty() && fails.isEmpty() && errors.isEmpty()) {
            System.out.println(PASS_COLOR + "Nothing to do. It seems your class doesn't have any tests." + RESET_COLOR);
            return;
        }

        System.out.println();

        System.out.println(START_COLOR + "Launched" + RESET_COLOR + ": " + (passes.size() + fails.size() + errors.size()) + " tests");
        System.out.println();

        if (!passes.isEmpty()) {

            System.out.println(PASS_COLOR + "Passed" + RESET_COLOR + ": " + passes.size() + " tests");

            System.out.print(PASS_COLOR);
            for (String pass : passes) {
                System.out.println("- " + pass);
            }
            System.out.println(RESET_COLOR);

        }

        if (!fails.isEmpty()) {

            System.out.println(FAIL_COLOR + "Failed" + RESET_COLOR + ": " + fails.size() + " tests");

            System.out.print(FAIL_COLOR);
            for (String fail : fails) {
                System.out.println("- " + fail);
            }
            System.out.println(RESET_COLOR);

        }

        if (!errors.isEmpty()) {

            System.out.println(ERROR_COLOR + "Errors" + RESET_COLOR + ": " + errors.size() + " tests");

            System.out.print(ERROR_COLOR);
            for (String error : errors) {
                System.out.println("- " + error);
            }
            System.out.println(RESET_COLOR);

        }

    }
}
